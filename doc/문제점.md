# 문제점

## 1. 동시 요청 처리

### 1.1. 문 제

멀티스레딩 환경에서 동시에 API 요청이 들어왔을 때 이중 결제와 유저 머니 갱신 손실 두 가지 문제가 있습니다.

### 1.2. 해 결

이중 결제는 API 파라미터로 트랜잭션 번호를 받아 DB에 UNIQUE 컬럼으로 저장하여 해결했습니다.

갱신 손실은 해당 유저 레코드에 배타락을 걸어 순차적으로 처리되도록하여 해결했습니다.

## 2. Enum 타입 저장

### 2.1. 문 제

MySQL 에서는 Enum 타입을 지원하지만, 다른 데이터베이스에서 지원하지 않습니다.

Enum 타입을 저장하기 위한 선택지가 두 가지있습니다.

Enum 상수의 이름을 저장하는 방법과 인덱스를 저장하는 방법입니다.

인덱스를 사용하는 경우 DB 단에서 사전에 약속된 인덱스를 모를 경우 의미를 파악하기 어렵습니다.

하지만, 시스템 리소스를 좀 더 효율적으로 사용할 수 있습니다.

`@Enumerated(EnumType.ORDINAL)`를 사용할 경우 Enum 을 인덱스로 저장하지만,

상수의 위치를 기반으로하기 때문에 상수의 위치가 바뀌면 문제가 발생합니다.

### 2.2. 해 결

`AttributeConverter`를 사용하여 Enum 상수의 코드 필드 값으로 저장되도록 구현했습니다.
